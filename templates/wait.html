{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='style.css')}}" media="all">
<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='waitStyle.css')}}" media="all">
<link href="https://fonts.googleapis.com/css?family=Questrial&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
{% endblock %}

{% block header %}
  {{super()}}
{% endblock %}

{% block content %}
<section>
    <center>
        <h1>Progress</h1>
        <div id="status" class="contentBody">
            <h2>S T A T U S</h2>
            <p>Your Job has been submitted</p>
            <div id="loadingBar"></div>
            <div id="status_div1"></div>
            <div id="status_div2"></div>
        </div>
  </center>
</section>
{% endblock %}

{% block scripts %}
{{super()}}
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script type="text/javascript">

    $().ready(function() {
        update_progress("{{url_for('status', user=user, job=job)}}");
    })
    
    function update_progress(status_url) {
        console.log('update progress');
        $.getJSON(status_url, function(data) {
            $('#loadingBar').removeClass('load');
            $('#loadingBar').addClass('load');
            if(data['status'] == 'finished') {
                if(data['error'] == '0') {
                    // success, post
                    console.log('SUCCESS');
                    window.location.href = '{{url_for("results", user=user, job=job)}}';
                } else {
                    $('#status_div1').text('Calculation Failed');
                    $('#status_div2').text('Try again and if problems still persist drop us an email.');
                }
            } else if(data['status'].substring(0, 5) == 'Error') {
                $('#status_div1').text('Job Submission Failed');
                $('#status_div2').text('Try again and if problems still persist drop us an email.');
            } else {
                // rerun function every 10 seconds if the calculation is not done
                setTimeout(function() {
                    update_progress(status_url);
                }, 5000);
            }

        });
    }
    
</script>


{% endblock %}
