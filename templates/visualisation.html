{% extends "base.html" %}

{% block head %}
{{super()}}
<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/resultsStyle.css')}}" media="all">
{% endblock %}


{% block scripts %}
{{super()}}
<script src="{{url_for('static', filename='ngl.js')}}"></script>

<script> 
    NGL.mainScriptPathFile = "{{url_for('static', filename='ngl.js')}}";

    $().ready( function() {

        stage = new NGL.Stage("viewport");
        stage.setParameters( { backgroundColor: "black" } );

        // load molecule structure
        loadPDB(stage, ".vor.pdb", "molecules", ["cartoon"],  [{colorScheme: 'bfactor'}], true);

        // load cavity neighboring residues
        loadPDB(stage, "_neighbors.pdb", "neighbors", ["licorice"],  [{color: schemeId}], true);

        // load cavities
        loadPDB(stage, "_holes.pdb", "cavities", ["ball+stick"], [{radius: 'bfactor', colorScheme: schemeId}]);
    });

    
    function getFileURL(ending) {
        var loc = window.location;
        var command = loc.protocol + "//" + loc.host + {% block file_download %}{% endblock %} + ending;
        return command;
    }


    function loadPDB(stage, ending, name, representations, representation_dicts, center) {
        file = getFileURL(ending);

        stage.loadFile(file, { defaultRepresentation: false }).then( function(comp) {
            comp.setName(name);
	    comp.setSelection("");

            for( var i = 0; i < representations.length; i++ ) {
	            comp.addRepresentation(representations[i], representation_dicts[i]);
            }

	    if(center) {
	        comp.autoView();
            //comp.centerView();
	    }
        });
    }

    // for color scheme
    var schemeId = NGL.ColormakerRegistry.addScheme(function (params) {
        this.atomColor = function (atom) {
            if (atom.occupancy < 0) {
                return 0x0000FF;  // blue
            } else if (atom.occupancy > 0.84) {
		return 0xFF0000;  // red
            } else {
                 return 0xFFFFFF;  // white
                 //return 0x00FF00;  // green
            }
        };
    });		
</script>

{% endblock %}
